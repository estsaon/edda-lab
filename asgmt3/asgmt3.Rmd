---
title: "Assignment 3"
author: 'Group 59: Peter Pan, Yuxiang Wang, Yancheng Zhuang'
date: "21 March 2021"
output:
  html_document:
    df_print: paged
fontsize: 11pt
highlight: tango
header-includes: \usepackage{bbm}
---

`r options(digits=3)`

## Exercise 1 
<!--
To investigate the effect of sexual activity on longevity of fruit flies, 
75 male fruit flies were divided randomly in three groups of 25. 
The fruit flies in the first group were kept solitary, 
those in the second were kept together with one virgin female fruit fly per day, 
and those in the third group were kept together with eight virgin female fruit flies a day. 
In the data-file fruitflies.txt the three groups are labelled isolated, low and high. 
The number of days until death (longevity) was measured for all flies. 
Later, it was decided to measure also the length of their thorax. 
Add a column loglongevity to the data-frame, containing the logarithm of the number of days until death. 
Use this as the response variable in the following.
-->

**a)** 
<!--
Make an informative plot of the data. 
Investigate whether sexual activity influences longevity by performing a statistical test, 
without taking the thorax length into account. 
What are the estimated longevities for the three conditions? Comment.
-->

```{r, fig.height=4.5, fig.width=4.5, fig.align='center'}
fly_data <- read.table("fruitflies.txt", header=TRUE)
fly_data$loglongevity <- log(fly_data$longevity)
with(fly_data, plot(loglongevity, thorax, pch=as.character(activity)))
```

Null hypothesis: sexual activity doesn't influence longevity.
We use 1-way ANOVA to test the influence of sexual activity and eliminate the thorax length.

```{r}
fly_lm <- lm(loglongevity ~ activity, data=fly_data)
res <- anova(fly_lm); res
```
According to the test result, we can notice that the $p < 0.05$, which leads us to reject the null hypothesis.  
So, without taking the thorax length into account, the sexual activity has impact on fly's longevity. 

```{r}
coef <- summary(fly_lm)$coefficients[, "Estimate"]; coef
```

The estimated loglongevities are shown above. 
So, estimated longevity of group *high* is `r exp(coef["(Intercept)"])`, 
estimated longevity of group *low* is `r exp(coef["(Intercept)"] + coef["activitylow"])`, 
estimated longevity of group *isolated* is `r exp(coef["(Intercept)"] + coef["activityisolated"])`.
The results indicate that fewer sexual activities lead to higher longevity.

**b)** 
<!--
Investigate whether sexual activity influences longevity by performing a statistical test, 
now including thorax length as an explanatory variable into the analysis. 
Does sexual activity increase or decrease longevity? 
What are the estimated longevities for the three groups, for a fly with average thorax length?
-->

Null hypothesis: sexual activity doesn't influence longevity.
To include thorax length as an explanatory variable into the analysis, we use ANCOVA test.
Thorax length is a numerical variable, sexual activity is a factor.

```{r}
fly_lm1 <- lm(loglongevity ~ activity + thorax, data=fly_data)
drop1(fly_lm1, test="F")
```
Accroding to the results, we can notice that both $p$-value of activity and thorax are smaller than $0.05$. 
Hence, $H_0$ is rejected. 
After taking the thorax length into account, both factors have great influence on longevity.

```{r}
coef <- summary(fly_lm1)$coefficients[, "Estimate"]; coef
```

As we can see, the estimated loglongevities become lower with more frequent sexual activity, 
so sexual activity decreases longevity. 
The estimated longevity is 
`r exp(coef["(Intercept)"] + coef["activitylow"] + coef["thorax"] * mean(fly_data[, "thorax"]))` for group *low*, 
`r exp(coef["(Intercept)"] + coef["activityisolated"] + coef["thorax"] * mean(fly_data[, "thorax"]))` for group *isolated*, 
and `r exp(coef["(Intercept)"] + coef["thorax"] * mean(fly_data[, "thorax"]))` for group *high*, for average thorax length.

**c)** 
<!--
How does thorax length influence longevity? 
Investigate graphically and by using an appropriate test 
whether this dependence is similar under all three conditions of sexual activity.
-->

```{r, fig.height=4.5, fig.width=4.5, fig.align='center'}
plot(loglongevity~thorax, pch=unclass(activity) ,data=fly_data)
activities <- c("isolated", "low", "high")
for(activity in activities) abline(lm(loglongevity~thorax,data=fly_data[fly_data$activity==activity,]))
```
Plot: the lines are not parallel, so we can conclude that the interaction between factor and predictor exists. And we can also say that longer the thorax, longer the longevity.

To test whether this dependence is similar under all three conditions of sexual activity,  we make an interaction plot.

```{r, fig.height=4.5, fig.width=4.5, fig.align='center'}
with(fly_data, interaction.plot(thorax, activity, loglongevity))
```

The lines are not parallel, so, there may exists the interaction between sexual activity and thorax length.

We also test again by considering the interaction of factor and predictor.

```{r}
fly_lm2 <- lm(loglongevity~factor(activity) * thorax, data = fly_data)
anova(fly_lm2)
```

Since the p-value of thorax is less than 0.05, 
indicating it has effect on longevity. 

**d)** 
<!--
Which of the two analyses, without or with thorax length, do you prefer? 
Is one of the analyses wrong?
-->

According to c), we would like to choose the analyses with thorax length.
Hence, we believe that the analyses without considering thorax should be wrong.

**e)** 
<!--
Verify normality and heteroscedasticity by making a normal QQ-plot of the residuals, 
and a residuals versus fitted plot, for the analysis that includes thorax length.
-->

```{r fig.height=3, fig.width=6, fig.align='center'}
par(mfrow=c(1, 2))
qqnorm(residuals(fly_lm1))
plot(fitted(fly_lm1), residuals(fly_lm1))
```

The points in the left plot are approximately on a straight line. 
The points in the right plot do not show any pattern. 
Therefore, we concludes that the normality and heteroscedasticity can be assumed.

**f)**
<!--
Perform the ancova analysis with the number of days as the response, rather than its logarithm. 
Verify normality and homoscedasticity of the residuals of this analysis. 
Was it wise to use the logarithm as response? 
-->

```{r fig.height=3, fig.width=6, fig.align='center'}
fly_lm3 <- lm(longevity~factor(activity) + thorax, data = fly_data)
res <- drop1(fly_lm3, test="F")
par(mfrow=c(1, 2))
qqnorm(residuals(fly_lm3))
plot(fitted(fly_lm3), residuals(fly_lm3))
```

The ANCOVA test with the number of days as the response has the same result with a) and b).
Moreover, normality and homoscedasticity of the residuals is the same with e).
However, we notice that the range of residuals gets enlarged with the increasing of fitted, which may be a pattern.
Hence, we think it's not necessary to use the logarithm as response.

## Exercise 2 
<!--
On April 15, 1912, British passenger liner Titanic sank after colliding with an iceberg. 
There were not enough lifeboats for everyone onboard, 
resulting in the death of 1502 out of 2224 passengers and crew. 
The data file titanic.txt gives the survival status of passengers on the Titanic, 
together with their names, age, sex and passenger class. 
(About half of the ages for the 3rd class passengers are missing, 
although many of these could be filled in from the original source.) 
The columns: 
Name – name of passenger, 
PClass – passenger class (1st, 2nd or 3rd), 
Age – age in years, 
Sex – male or female, 
Survived – survival status (1=Yes or 0=No).
-->

**a)** 
<!--
Study the data and give a few (>1) summaries (graphics or tables). 
-->

**b)** 
<!--
Fit a logistic regression model (no interactions yet) to investigate 
the association between the survival status and the predictors PClass, Age and Sex. 
Interpret the results in terms of odds, comment.
-->

**c)** 
<!--
Investigate for interaction of predictor Age with factors PClass and Sex. 
From this and b), choose (and justify) a resulting model. 
For this model, report the estimate for the probability of survival for
each combination of levels of the factors PClass and Sex for a person of age 53.
-->

**d)** 
<!--
Propose a method to predict the survival status and a quality measure for your prediction and 
describe how you would implement that method (you do not need to implement it).
-->

**e)** 
<!--
Another approach would be to apply a contingency table test to 
investigate whether factor passenger class (and gender) has an effect on the survival status. 
Implement the relevant test(s).
-->

**f)** 
<!--
Is the second approach in e) wrong? 
Name both an advantage and a disadvantage of the two approaches, relative to each other. 
-->

## Exercise 3
<!--
To study the influence of different political and geographical variables on the number of military coups, 
these data are collected for several Sub Saharan African countries in the file africa.txt. 
The meaning of the different variables:
miltcoup — number of successful military coups from independence to 1989;
oligarchy — number years country ruled by military oligarchy from independence to 1989;
pollib — political liberalization 
    0 = no civil rights for political expression, 
    1 = limited civil rights for expression but right to form political parties
    2 = full civil rights;
parties — number of legal political parties in 1993;
pctvote — percent voting in last election;
popn — population in millions in 1989;
size — area in 1000 square km;
numelec — total number of legislative and presidential elections;
numregim — number of regime types.
-->

**a)** 
<!--
Perform Poisson regression on the full data set africa, 
taking miltcoup as response variable, Comment on your findings. 
-->

**b)** 
<!--
Use the step down approach (using output of the function summary) to 
reduce the number of explanatory variables. 
Compare the resulting model with your findings in a).
-->

**c)** 
<!--
Predict the number of coups for a hypothetical country for all the three levels of political liberalization
and the averages (over all the counties in the data) of all the other (numerical) characteristics. 
Comment on your findings.
-->
